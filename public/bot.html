<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Coach AI</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"><\/script>
<style>
:root{--accent:#E63946;--accent-hover:#c1121f;--bg:#0b0b0f;--surface:#131318;--surface2:#1a1a22;--border:#252530;--text:#ebebf0;--text-dim:#8b8b9e;--text-muted:#55556a}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:"DM Sans",sans-serif;background:var(--bg);color:var(--text);height:100vh;height:100dvh;display:flex;flex-direction:column;overflow:hidden;-webkit-font-smoothing:antialiased}
.auth-screen{flex:1;display:flex;align-items:center;justify-content:center;padding:20px}
.auth-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:40px;width:100%;max-width:400px}
.auth-card h1{font-size:24px;font-weight:700;margin-bottom:4px}
.auth-card .subtitle{color:var(--text-dim);font-size:14px;margin-bottom:28px}
.field{margin-bottom:16px}
.field label{display:block;font-size:13px;font-weight:500;color:var(--text-dim);margin-bottom:6px}
.field input{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-family:inherit;font-size:15px;outline:none;transition:border-color .2s}
.field input:focus{border-color:var(--accent)}
.auth-btn{width:100%;background:var(--accent);color:white;border:none;border-radius:8px;padding:13px;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;transition:background .2s;margin-top:8px}
.auth-btn:hover{background:var(--accent-hover)}
.auth-btn:disabled{opacity:.5;cursor:not-allowed}
.auth-toggle{text-align:center;margin-top:20px;font-size:14px;color:var(--text-dim)}
.auth-toggle a{color:var(--accent);cursor:pointer;text-decoration:none}
.auth-error{background:#2a1215;border:1px solid #5c2028;color:#f0a0a8;padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:16px;display:none}
.header{background:var(--surface);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;gap:12px;flex-shrink:0}
.header-brand{font-weight:700;font-size:18px}
.header-brand span{color:var(--accent)}
.header-right{margin-left:auto;display:flex;align-items:center;gap:12px}
.usage-pill{font-family:"DM Mono",monospace;font-size:11px;color:var(--text-muted);background:var(--surface2);border:1px solid var(--border);padding:4px 10px;border-radius:20px}
.logout-btn{font-family:inherit;font-size:12px;color:var(--text-muted);background:none;border:1px solid var(--border);padding:5px 12px;border-radius:6px;cursor:pointer}
.logout-btn:hover{color:var(--text);border-color:var(--text-muted)}
.messages{flex:1;overflow-y:auto;padding:24px 20px;display:flex;flex-direction:column;gap:20px}
.messages::-webkit-scrollbar{width:5px}
.messages::-webkit-scrollbar-thumb{background:#333;border-radius:3px}
.msg{max-width:88%;animation:fadeUp .3s ease}
.msg.user{align-self:flex-end;background:var(--accent);color:white;padding:12px 16px;border-radius:16px 16px 4px 16px;font-size:15px;line-height:1.5}
.msg.assistant{align-self:flex-start;background:var(--surface);border:1px solid var(--border);padding:18px 22px;border-radius:4px 16px 16px 16px;font-size:15px;line-height:1.7}
.msg.assistant p{margin-bottom:12px}.msg.assistant p:last-child{margin-bottom:0}
.msg.assistant strong{color:var(--accent);font-weight:600}
.sources-bar{margin-top:14px;padding-top:12px;border-top:1px solid var(--border)}
.sources-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:6px}
.source-chip{display:inline-block;font-size:11px;color:var(--text-dim);background:var(--surface2);border:1px solid var(--border);padding:3px 9px;border-radius:4px;margin:2px 4px 2px 0}
.welcome{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}
.welcome h2{font-size:26px;font-weight:700;margin-bottom:8px}
.welcome h2 span{color:var(--accent)}
.welcome p{color:var(--text-dim);font-size:15px;max-width:480px;line-height:1.6;margin-bottom:32px}
.suggestions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;max-width:600px}
.suggestion{background:var(--surface);border:1px solid var(--border);padding:10px 16px;border-radius:10px;font-size:13px;color:var(--text-dim);cursor:pointer;transition:all .2s}
.suggestion:hover{border-color:var(--accent);color:var(--text)}
.input-area{padding:16px 20px 20px;border-top:1px solid var(--border);background:var(--surface);flex-shrink:0}
.input-row{display:flex;gap:10px;max-width:800px;margin:0 auto;align-items:flex-end}
.input-row textarea{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-family:"DM Sans",sans-serif;font-size:15px;resize:none;min-height:46px;max-height:120px;line-height:1.4;outline:none}
.input-row textarea:focus{border-color:var(--accent)}
.input-row textarea::placeholder{color:var(--text-muted)}
.send-btn{width:46px;height:46px;background:var(--accent);border:none;border-radius:10px;color:white;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.send-btn:hover{background:var(--accent-hover)}
.send-btn:disabled{opacity:.3;cursor:not-allowed}
.typing{display:flex;gap:5px;padding:8px 0}
.typing span{width:7px;height:7px;background:var(--text-muted);border-radius:50%;animation:bounce .6s infinite alternate}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounce{to{transform:translateY(-4px)}}
@media(max-width:600px){.header{padding:10px 14px}.messages{padding:16px 14px}.msg{max-width:94%}.input-area{padding:12px 14px 16px}.auth-card{padding:28px 24px}.suggestions{flex-direction:column}}
</style>
</head>
<body>
<div id="authScreen" class="auth-screen" style="display:none">
<div class="auth-card">
<h1 id="authTitle">Sign In</h1>
<p class="subtitle" id="authSubtitle">Access your coaching knowledge base</p>
<div class="auth-error" id="authError"></div>
<div class="field"><label>Email</label><input type="email" id="authEmail" placeholder="you@example.com"></div>
<div class="field"><label>Password</label><input type="password" id="authPassword" placeholder="Your password" onkeydown="if(event.key==='Enter')doAuth()"></div>
<div class="field" id="nameField" style="display:none"><label>Full Name</label><input type="text" id="authName" placeholder="Your name"></div>
<button class="auth-btn" id="authBtn" onclick="doAuth()">Sign In</button>
<div class="auth-toggle"><span id="authToggleText">No account? </span><a id="authToggleLink" onclick="toggleAuth()">Sign up</a></div>
</div></div>
<div id="chatScreen" style="display:none">
<div class="header">
<div class="header-brand"><span>Coach</span>AI</div>
<div class="header-right">
<div class="usage-pill" id="usagePill"></div>
<button class="logout-btn" onclick="doLogout()">Sign out</button>
</div></div>
<div id="chatArea"></div>
<div class="input-area"><div class="input-row">
<textarea id="chatInput" rows="1" placeholder="Ask about movements, nutrition, coaching, programming..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}" oninput="autoResize(this)"></textarea>
<button class="send-btn" id="sendBtn" onclick="sendMessage()">&#9654;</button>
</div></div></div>
<script>
const SUPABASE_URL="https://hsiqzmbfulmfxbvbsdwz.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhzaXF6bWJmdWxtZnhidmJzZHd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MTQ5NjYsImV4cCI6MjA4NjQ5MDk2Nn0.Il9Qgv06SoHhKaXNw5FESukqtb-7eQotp9XtDwZ_5uI";
const CHAT_ENDPOINT=SUPABASE_URL+"/functions/v1/chat";
const sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
let session=null,messages=[],isLoading=false,dailyUsage=0,dailyLimit=75,isSignUp=false;
async function init(){const{data:{session:s}}=await sb.auth.getSession();if(s){session=s;showChat()}else{showAuth()}sb.auth.onAuthStateChange((ev,s)=>{session=s;if(s)showChat();else showAuth()})}
function showAuth(){document.getElementById("authScreen").style.display="flex";document.getElementById("chatScreen").style.display="none"}
function showChat(){document.getElementById("authScreen").style.display="none";document.getElementById("chatScreen").style.display="flex";updateUsage();renderChat()}
function toggleAuth(){isSignUp=!isSignUp;document.getElementById("authTitle").textContent=isSignUp?"Create Account":"Sign In";document.getElementById("authSubtitle").textContent=isSignUp?"Start your coaching journey":"Access your coaching knowledge base";document.getElementById("authBtn").textContent=isSignUp?"Create Account":"Sign In";document.getElementById("nameField").style.display=isSignUp?"block":"none";document.getElementById("authToggleText").textContent=isSignUp?"Have an account? ":"No account? ";document.getElementById("authToggleLink").textContent=isSignUp?"Sign in":"Sign up";document.getElementById("authError").style.display="none"}
async function doAuth(){const email=document.getElementById("authEmail").value.trim();const pw=document.getElementById("authPassword").value;const err=document.getElementById("authError");const btn=document.getElementById("authBtn");if(!email||!pw){err.textContent="Enter email and password";err.style.display="block";return}btn.disabled=true;btn.textContent=isSignUp?"Creating...":"Signing in...";err.style.display="none";try{let r;if(isSignUp){const name=document.getElementById("authName").value.trim();r=await sb.auth.signUp({email,password:pw,options:{data:{full_name:name}}})}else{r=await sb.auth.signInWithPassword({email,password:pw})}if(r.error){err.textContent=r.error.message;err.style.display="block"}}catch(e){err.textContent=e.message;err.style.display="block"}btn.disabled=false;btn.textContent=isSignUp?"Create Account":"Sign In"}
async function doLogout(){await sb.auth.signOut();messages=[];session=null}
function updateUsage(){document.getElementById("usagePill").textContent=dailyUsage+"/"+dailyLimit+" today"}
async function sendMessage(){const inp=document.getElementById("chatInput");const text=inp.value.trim();if(!text||isLoading||!session)return;inp.value="";autoResize(inp);messages.push({role:"user",content:text});isLoading=true;renderChat();try{const resp=await fetch(CHAT_ENDPOINT,{method:"POST",headers:{"Authorization":"Bearer "+session.access_token,"Content-Type":"application/json"},body:JSON.stringify({question:text,history:messages.slice(-10)})});const data=await resp.json();if(!resp.ok)throw new Error(data.error||"Something went wrong");messages.push({role:"assistant",content:data.answer,sources:data.sources});if(data.usage){dailyUsage=data.usage.daily_questions;dailyLimit=data.usage.daily_limit;updateUsage()}}catch(e){messages.push({role:"assistant",content:"**Error:** "+e.message,sources:[]})}isLoading=false;renderChat()}
function renderChat(){const area=document.getElementById("chatArea");if(messages.length===0&&!isLoading){area.className="welcome";area.innerHTML='<h2>Ask <span>Anything</span></h2><p>Powered by hundreds of articles covering movements, nutrition, coaching methodology, programming, and affiliate business.</p><div class="suggestions"><div class="suggestion" onclick="askQ(this)">What are the points of performance for the air squat?</div><div class="suggestion" onclick="askQ(this)">How should I scale workouts for beginners?</div><div class="suggestion" onclick="askQ(this)">What is the nutritional prescription?</div><div class="suggestion" onclick="askQ(this)">How do I improve member retention?</div><div class="suggestion" onclick="askQ(this)">Explain the three metabolic pathways</div><div class="suggestion" onclick="askQ(this)">What does virtuosity mean?</div></div>';return}area.className="messages";let html="";for(const m of messages){if(m.role==="user"){html+='<div class="msg user">'+esc(m.content)+"</div>"}else{const f=fmt(m.content);let sh="";if(m.sources&&m.sources.length>0){const t=[...new Set(m.sources.map(s=>s.title).filter(Boolean))];if(t.length){sh='<div class="sources-bar"><div class="sources-label">Sources</div>'+t.map(x=>'<span class="source-chip">'+esc(x)+"</span>").join("")+"</div>"}}html+='<div class="msg assistant">'+f+sh+"</div>"}}if(isLoading){html+='<div class="msg assistant"><div class="typing"><span></span><span></span><span></span></div></div>'}area.innerHTML=html;area.scrollTop=area.scrollHeight}
function fmt(t){return t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n\n/g,"</p><p>").replace(/\n- /g,"<br>\u2022 ").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>").replace(/<p><\/p>/g,"")}
function esc(t){const d=document.createElement("div");d.textContent=t;return d.innerHTML}
function askQ(el){document.getElementById("chatInput").value=el.textContent;sendMessage()}
function autoResize(el){el.style.height="auto";el.style.height=Math.min(el.scrollHeight,120)+"px"}
init();
<\/script>
</body></html>